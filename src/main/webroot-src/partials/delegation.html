<h2>{{'DELEGATION_REGISTER_USER_TITLE'|translate}}:</h2>

<form role="form" id="delegationForm" name="delegationForm">
  <div class="form-group container">
    <div class="row marginB10">
      <div id="NameAndPic" class="row col-md-12 col-xs-12 dol-sm-12 col-lg-12 pull-right">
        <div class="row col-xs-6 col-sm-7 col-lg-10 col-md-9">
          <div class="row marginB10"
               ng-class="delegationForm.gender.$valid ? 'has-success' : 'has-error'">
            <label>{{'GENERIC_GENDER'|translate}}</label>
            <select 
               class="form-control" 
               id="gender" 
               name="gender"
               ng-model="person.gender"
               ng-options="option.label | translate for option in genderOptions"
               required />
              <option value="">{{'GENERIC_PLEASE_SELECT'|translate}}</option>
            </select>
            <p ng-show="delegationForm.gender.$invalid && !delegationForm.gender.$pristine" class="help-block">
            {{'GENERIC_MISSING_GENDER_MESSAGE'|translate}}
            </p>
          </div>

          <div class="row">
            <div class="col-md-6 paddingL0 marginB10"
                 ng-class="delegationForm.firstname.$valid ? 'has-success' : 'has-error'">
              <label>{{'GENERIC_FIRSTNAME'|translate}}</label>
              <input type="text" 
                     class="form-control" 
                     id="firstname"
                     name="firstname"
                     placeholder="{{'GENERIC_FIRSTNAME'|translate}}"
                     ng-model="person.firstname" required />

              <p ng-show="delegationForm.firstname.$error.required && !delegationForm.firstname.$pristine" class="help-block">
              {{'GENERIC_MISSING_FIRSTNAME_MESSAGE'|translate}}
              </p>
              <p ng-show="delegationForm.firstname.$error.maxlength && !delegationForm.firstname.$pristine" class="help-block">
              {{'GENERIC_MESSAGE_FIRSTNAME_MAX'|translate}}
              </p>
            </div>
            <div class="col-md-6 paddingLR0 marginB10"
                 ng-class="delegationForm.lastname.$valid ? 'has-success' : 'has-error'">
              <label>{{'GENERIC_LASTNAME'|translate}}</label>
              <input type="text"
                     class="form-control" 
                     id="lastname"
                     name="lastname"
                     placeholder="{{'GENERIC_LASTNAME'|translate}}"
                     ng-model="person.lastname" 
                     required 
                     ng-maxlength="35"/>

              <p ng-show="delegationForm.lastname.$error.required && !delegationForm.lastname.$pristine" class="help-block">
              {{'GENERIC_MESSAGE_MISSING_LASTNAME'|translate}}
              </p>
              <p ng-show="delegationForm.lastname.$error.maxlength && !delegationForm.lastname.$pristine" class="help-block">
              {{'GENERIC_MESSAGE_LASTNAME_MAX'|translate}}
              </p>
            </div>
          </div>
          <div class="row marginB10">
            <label>{{'GENERIC_FUNCTION'|translate}}</label>
            <select class="form-control" id="functionDescription" name="functionDescription"
                                                                  ng-model="person.functionDescription" ng-options="function for function in functions"/>
            </select>
          </div>

          <div class="row marginB10">
            <label>{{'GENERIC_CATEGORY'|translate}}</label>
            <select class="form-control" id="category" name="category" ng-model="person.category"
                                                                       ng-options="category for category in categories"/></select>
          </div>
        </div>

        <div class="row col-xs-6 col-sm-5 col-lg-2 col-md-3 pull-right">
          <div class="row">
            <!--<div ng-include src="'partials/fileupload.html'"></div>-->
            <image-upload image="image"></image-upload>
          </div>
        </div>
      </div>
    </div>
    <div id="collapse-formular" ng-show="extraFields.length>0">
      <hr size="95%"/>
      <a href="" class="" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false"
                                                                                aria-controls="collapseExample">
        {{'DELEGATION_EXTRA_FIELDS_TITLE'|translate}}
      </a>

      <div class="collapse in" id="collapseExample">
        <div class="well">
          <div class="form-group container">
            <extra-field ng-repeat="field in extraFields" field="field" person="person"></extra-field>
          </div>
        </div>
      </div>
    </div>

    <hr size="95%"/>
  </div>
</form>

<div class="col-xs-12 text-right">
  <button type="submit" class="btn btn-custom" ng-click="register_user()" ng-disabled="delegationForm.$invalid">{{'GENERIC_SAVE'|translate}}</button>
  <button type="button" class="btn btn-custom" data-toggle="modal" data-target="#extraFieldsDialog" >
    {{'GENERIC_CLEAR_FIELDS'|translate}}
  </button>
</div>

<h2>{{'DELEGATION_ALREADY_REGISTERED'|translate}}:</h2>
<table class="table table-striped table-hover">
  <tr class="active">
    <th>{{'GENERIC_FIRSTNAME'|translate}}</th>
    <th>{{'GENERIC_LASTNAME'|translate}}</th>
  </tr>
  <tr id="delegation" ng-click="loadPersonData(person.pk)" style="cursor:pointer;" data-target="#extraFieldsDialog" ng-repeat="person in presentPersons">
    <td>
      {{person.firstname_a_e1}}
    </td>
    <td>
      {{person.lastname_a_e1}}
    </td>
  </tr>

</table>

<!-- Modal -->
<div class="modal fade" id="extraFieldsDialog" tabindex="-1" role="dialog" aria-labelledby="extraFieldsDialogLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="extraFieldsDialogLabel">{{'GENERIC_CONFIRMATION'|translate}}</h4>
      </div>

      <div class="form-group container">
        <p>{{'DELEGATION_EMPTY_FIELDS'|translate}}</p>
        <button type="button" class="btn btn-custom" data-dismiss="modal" ng-click="$flow.files=[]; refreshData(); obj.flow.cancel(); ">
          {{'GENERIC_YES'|translate}}
        </button>

        <button type="button" class="btn btn-custom" data-dismiss="modal" >
          {{'GENERIC_NO'|translate}}
        </button>
      </div>
    </div>
  </div>
</div>
