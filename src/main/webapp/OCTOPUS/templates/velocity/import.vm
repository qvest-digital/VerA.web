#set($activeMenu = "Personen")
#set($title = "Import von Personendaten")
#set($elementNameSex = "female")
#set($elementNameSingular = "Person")
#set($elementNamePlural = "Personen")
#parse("inc/header.vm")

	<div id="content_container">
		<div id="breadcrumb" class="textRight marginBottom10">
			<strong>${placeholderWithTranslation.siesindhier}</strong> <span><a href="${paths.staticWeb}do/" title="${placeholderWithTranslation.ZurStartseite}">${placeholderWithTranslation.Home}</a> > ${placeholderWithTranslation.Personen} > ${placeholderWithTranslation.Personenimport}</span>
		</div>

		<h1>${placeholderWithTranslation.ImportvonPersonendaten}</h1>

        #if($errors.size() > 0 || $importStatus.invalidData)
            <vera-warn>
            	#if($importStatus.invalidData == "importSource")
            		${placeholderWithTranslation.SiehabenkeineDatenherkunftangegeben}
            	#elseif($importStatus.invalidData == "fileExtension")
            		#if($importStatus.fileextension == "ods")
            			${placeholderWithTranslation.SiehabenversuchteineStarOfficebzwOpenOfficeDateizuimportierenDerdirekteImportistinderaktuellenVersionvonVerAwebleidernichtmoglichBittespeichernSiedieseDateizuerstmitIhremTabellenkalkulationsprogrammalscsvDateiab}
            		#elseif($importStatus.fileextension == "sxc")
            			${placeholderWithTranslation.SiehabenversuchteineStarOfficebzwOpenOfficeDateizuimportierenDerdirekteImportistinderaktuellenVersionvonVerAwebleidernichtmoglichBittespeichernSiedieseDateizuerstmitIhremTabellenkalkulationsprogrammalscsvDateiab}
            		#elseif($importStatus.fileextension == "xls")
            			${placeholderWithTranslation.SiehabenversuchteineMicrosoftExcelDateizuimportierenDerdirekteImportvonExcelDokumentenistinderaktuellenVersionvonVerAwebleidernichtmolichBittespeichernSiedieseDateizuerstmitIhremTabellenkalkulationsprogrammalscsvDateiab}
            		#elseif($importStatus.fileextension == "pdf")
            			${placeholderWithTranslation.SiehabenversuchteinePDFDateizuimportierenDiesistinderaktuellenVersionvonVerAwebleidernichtmoglich}
            		#elseif($importStatus.fileextension == "zip")
            			${placeholderWithTranslation.SiehabenversuchteineZIPDateizuimportierenDiesistinderaktuellenVersionvonVerAwebleidernichtmoglich}
            		#elseif($importStatus.fileextension == "exe")
            			${placeholderWithTranslation.SiehabenversuchteineEXEDateizuimportierenDiesistinderaktuellenVersionvonVerAwebleidernichtmoglich}
            		#else
            			${placeholderWithTranslation.SiehabenversuchteineDateimitderEndung}
            			$importStatus.fileextension ${placeholderWithTranslation.zuimportierenDiesistinderaktuellenVersionvonVerAwebleidernichtmoglich}
            		#end
            	#elseif($importStatus.invalidData == "inputStream")
            		${placeholderWithTranslation.SiehabenkeineDateiausgewahltoderdiesewarleer}
            	#elseif($importStatus.invalidData == "errorOnImport")
            		${placeholderWithTranslation.EsisteinunerwarteterFehlerbeimimportiereneinerDateiaufgetreten}<br>
            		${placeholderWithTranslation.VermutlichbefindetsichdieImportDateinichtimvomSystemerwartemFormat}<br><br>

            		${placeholderWithTranslation.Fehlermeldung} <em>&quot;$message.plain($importStatus.message)&quot;</em> &nbsp;&nbsp;&nbsp;
            		(<a href="javascript:showBlock(document.getElementById('javastacktrace'));">${placeholderWithTranslation.Detailsanzeigen}</a>)

            <pre id="javastacktrace" style="display: none;">

            $importStatus.exception
            </pre>

            	#end

            	#foreach($error in $errors)
            		$error
            	#end
            </vera-warn>
		#end

		<vera-info>
			${placeholderWithTranslation.BeimImportkonnenFeldinhaltedielangeralsbeiVerAwebvorgesehensindgekurztubernommenwerden}
		</vera-info>


		<div id="main_content" class="contentBoxColored grayBorder">
			<div class="textRight mandatoryText">* = ${placeholderWithTranslation.Pflichtfelder}</div>

            <form action="ImportPersonsFile" method="post" enctype="multipart/form-data" name="formImport" id="formImport" >

    			<div class="table width100">
    				<div class="tableRow">
    					<div class="tableCell width50">
    						<label for="importSource">${placeholderWithTranslation.Datenherkunft}</label>
    						<input type="text" name="importSource" id="importSource" value="$!message.text($importSource)">
    					</div>
    					<div class="tableCell width50">
							#if($grants && $grants.isAdmin() && $allOrgUnit)
								<label for="orgUnit">${placeholderWithTranslation.Zielmandant}</label>
								<select name="orgUnit" id="orgUnit" >
									#foreach($orgunit in $allOrgUnit)
										<option value="$orgunit.id" #if($octopusConfig.personalConfig.orgUnitId == $orgunit.id)selected#end>$!message.text($orgunit.name)</option>
									#end
								</select>
							#end
    					</div>
    				</div>

    				<div class="tableRow">
    					<div class="tableCell">
    						<label for="importfile">${placeholderWithTranslation.ImportDatei}</label>
    						<input name="importfile" id="importfile" type="file" size="30" maxlength="100000" accept="text/*">
    					</div>
    					<div class="tableCell">
    						<label for="format">${placeholderWithTranslation.Dateityp}</label>
    						<select name="format" id="format" onchange="return formatChanged();">
                            #foreach($formatKey in $formats.keySet())
                             #set($format = $formats.get($formatKey))
                            	<option value="$formatKey">$format.name ($format.description)</option>
                            #end
                            </select>

                            #set($style = '')
                            #foreach($formatKey in $formats.keySet())
                             #set($format = $formats.get($formatKey))
                            		<div $style id="format-$formatKey" class="marginTop20">
                              #if($format.properties.containsKey("choices"))
                               #set($choices = $format.properties.get("choices"))
                            			<fieldset class="format"><legend>$format.name: ${placeholderWithTranslation.weitere Optionen</legend>
                                			<div class="table width100">
                               #foreach($choiceKey in $choices.keySet())
                                #set($choice = $choices.get($choiceKey))
                                				<div class="tableRow">
                            						<div class="tableCell width30"><label for="format-${formatKey}-$choiceKey">$!choice.get("label")</label></div>
                            						<div class="tableCell">
                                #set($default = $choice.get("default"))
                                #if($choice.containsKey("select"))
                                 #set($select = $choice.get("select"))
                            							<select name="format-${formatKey}-$choiceKey" id="format-${formatKey}-$choiceKey" >
                                 #foreach($selectKey in $select.keySet())
                            								<option value="$selectKey"#if($selectKey==$default) selected#end>$select.get($selectKey)</option>
                                 #end
                            							</select>
                                #else
                                						<input type="text" name="format-${formatKey}-$choiceKey" id="format-${formatKey}-$choiceKey" value="$!default" >
                                #end
                            						</div>
                                				</div>
                               #end
                                			</div>
                            			</fieldset>
                              #end
                            		</div>
                             #set($style = 'style="display:none;"')
                            #end
                            <script type="text/javascript">
                            	function formatChanged() {
                            #foreach($formatKey in $formats.keySet())
                            		document.getElementById('format-$formatKey').style.display = 'none';
                            #end
                            		document.getElementById('format-' + document.formImport.format.options[document.formImport.format.options.selectedIndex].value).style.display = '';
                            		return true;
                            	}
                            </script>
    					</div>
    				</div>
    			</div>


            </form>

		</div><!-- End #main_content-->

		<div id="buttonPanel-bottom" class="textRight marginTop10">
			<input name="start" type="button" value="${placeholderWithTranslation.Importstarten}" title="${placeholderWithTranslation.Importstarten}" class="mainButton" onclick="askStart()">
		</div>
</div>
<script type="text/javascript">
##Hinweis und Rueckfrage vor dem Import

	function askStart() {
		htmlConfirm(' ${placeholderWithTranslation.AlleDokumenttypenderzuimportierendenPersonenmussenimSystemvorhandenseinSollderImportjetztgestartetwerden ', new Array(' ${placeholderWithTranslation.Ja} ', ' ${placeholderWithTranslation.Nein} '), new Array("askStartYes();", "askStartNo();"));
	}
	function askStartYes() {
		hideDialogs();
		showComboboxes();
		htmlWait();
		document.getElementById('formImport').submit();
	}
	function askStartNo() {
		hideDialogs();
		showComboboxes();
	}
</script>

##<!-- Bug 1362: Die Möglichkeit, einen bestehenden Exportvorgang zu laden, ist vom AA nicht gewünscht -->
##<br>
##<hr class="contentsection" />
##<br>
##<h1>Bestehenden Importvorgang laden</h1>
##<form action="ImportPersonsStoredRecord" method="post" enctype="multipart/form-data">
##<table class="form"><tr>
##	<td><label for="importId">Import-ID</label></td>
##	<td align="right">
##	    <input type="text" name="importId" id="importId" value="" >
##	</td>
##</tr><tr>
##	<td>&nbsp;</td>
##	<td>
##		<input name="submit" type="submit" value="Laden" class="submit">
##	</td>
##</tr></table>
##</form>

#parse("inc/footer.vm")
