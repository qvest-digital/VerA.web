#set($activeMenu = "Personen")
#set($title = "Import von Personendaten")
#parse("inc/header.vm")

	<div id="content_container">
		<div id="breadcrumb" class="textRight">
			<strong>Sie sind hier:</strong> <span><a href="${paths.staticWeb}do/" title="Zur Startseite">Home</a> > Personen > Personenimport</span>
		</div>
		
		<h1>Import von Personendaten</h1>

        #if($errors.size() > 0 || $importStatus.invalidData)
            <div style="margin: 10px 0px 10px 0px; padding: 10px 10px 10px 10px; background-color: #ffffff; border: 2px solid #ff0000;">
            	#if($importStatus.invalidData == "importSource")
            		Sie haben keine Datenherkunft angegeben.
            	#elseif($importStatus.invalidData == "fileExtension")
            		#if($importStatus.fileextension == "ods")
            			Sie haben versucht eine StarOffice bzw. OpenOffice-Datei zu importieren.
            			Der direkte Import ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            			Bitte speichern Sie diese Datei zuerst mit Ihrem Tabellenkalkulationsprogramm als .csv-Datei ab.
            		#elseif($importStatus.fileextension == "sxc")
            			Sie haben versucht eine StarOffice bzw. OpenOffice-Datei zu importieren.
            			Der direkte Import ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            			Bitte speichern Sie diese Datei zuerst mit Ihrem Tabellenkalkulationsprogramm als .csv-Datei ab.
            		#elseif($importStatus.fileextension == "xls")
            			Sie haben versucht eine Microsoft Excel-Datei zu importieren.
            			Der direkte Import von Excel-Dokumenten ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            Bitte speichern Sie diese Datei zuerst mit Ihrem Tabellenkalkulationsprogramm als .csv-Datei ab.
            		#elseif($importStatus.fileextension == "pdf")
            			Sie haben versucht eine PDF-Datei zu importieren.
            			Dies ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            		#elseif($importStatus.fileextension == "zip")
            			Sie haben versucht eine ZIP-Datei zu importieren.
            			Dies ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            		#elseif($importStatus.fileextension == "exe")
            			Sie haben versucht eine EXE-Datei zu importieren.
            			Dies ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            		#else
            			Sie haben versucht eine Datei mit der Endung
            			$importStatus.fileextension zu importieren.
            			Dies ist in der aktuellen Version von VerA.web leider nicht m&ouml;glich.
            		#end
            	#elseif($importStatus.invalidData == "inputStream")
            		Sie haben keine Datei ausgew&auml;hlt oder diese war leer.
            	#elseif($importStatus.invalidData == "errorOnImport")
            		Es ist ein unerwarteter Fehler beim importieren einer Datei aufgetreten.<br>
            		Vermutlich befindet sich die Import-Datei nicht im vom System erwartem Format.<br><br>
            		
            		Fehlermeldung: <em>&quot;$message.plain($importStatus.message)&quot;</em> &nbsp;&nbsp;&nbsp;
            		(<a href="javascript:showBlock(document.getElementById('javastacktrace'));">Details anzeigen</a>)
            
            <pre id="javastacktrace" style="display: none;">
            
            $importStatus.exception
            </div>
            	
            	#end
            	
            	#foreach($error in $errors)
            		$error
            	#end
            </div>
		#end		

		<div class="contentBoxColored hinweis grayBorder marginBottom20">
			<strong>Hinweis</strong>
			<p>Beim Import k&ouml;nnen Feldinhalte, die l&auml;nger als bei VerA.web vorgesehen sind, gek&uuml;rzt &uuml;bernommen werden.</p>
		</div>
			
		
		<div id="main_content" class="contentBoxColored grayBorder marginBottom20">
		
		
			
			<div id="buttonPanel-bottom" class="">
				<input name="start" type="button" value="Import starten" title="Import starten" class="mainButton" onclick="askStart()">
 			</div>			
		</div><!-- End #main_content-->

        <form action="ImportPersonsFile" method="post" enctype="multipart/form-data" name="formImport" id="formImport" >
        
			<div class="table width100">
				<div class="tableRow">
					<div class="tableCell width50">
						<label for="importSource">Datenherkunft:</label>
						<input type="text" name="importSource" id="importSource" value="$!message.text($importSource)">
					</div>
					<div class="tableCell width50">
						<label for="orgUnit">Zielmandant:</label>
						<select name id>
							<option value="Alle">Alle</option>
						</select>
					</div>
				</div>

                #if($grants && $grants.isAdmin() && $allOrgUnit)
                <div class="tableRow">
					<div class="tableCell">
						<label for=""></label>
                 		<select name="orgUnit" id="orgUnit" class="combobox">
                         #foreach($orgunit in $allOrgUnit)
                        	<option value="$orgunit.id" #if($octopusConfig.personalConfig.orgUnitId == $orgunit.id)selected#end>$orgunit.name</option>
                         #end
                		</select>
                	</div>
                </div>
				#end
				
				<div class="tableRow">
					<div class="tableCell">
						<label for="importfile">Import-Datei:</label>
						<input name="importfile" id="importfile" type="file" size="30" maxlength="100000" accept="text/*">
					</div>
					<div class="tableCell">
						<label for="format">Dateityp:</label>
						<select name="format" id="format" class="combobox" onchange="return formatChanged();">
                        #foreach($formatKey in $formats.keySet())
                         #set($format = $formats.get($formatKey))
                        	<option value="$formatKey">$format.name ($format.description)</option>
                        #end
                        </select>
					</div>
				</div>
			</div>
	
            #set($style = '')
            #foreach($formatKey in $formats.keySet())
             #set($format = $formats.get($formatKey))
            		<div $style id="format-$formatKey">
              #if($format.properties.containsKey("choices"))
               #set($choices = $format.properties.get("choices"))
            			<fieldset class="format"><legend>$format.name: weitere Optionen</legend>
                			<div class="table width100">
               #foreach($choiceKey in $choices.keySet())
                #set($choice = $choices.get($choiceKey))
                				<div class="tableRow">
            						<div class="tableCell"><label for="format-${formatKey}-$choiceKey">$!choice.get("label"):</label></div>
            						<div class="tableCell">
                #set($default = $choice.get("default"))
                #if($choice.containsKey("select"))
                 #set($select = $choice.get("select"))
            							<select name="format-${formatKey}-$choiceKey" id="format-${formatKey}-$choiceKey" class="combobox">
                 #foreach($selectKey in $select.keySet())
            								<option value="$selectKey"#if($selectKey==$default) selected#end>$select.get($selectKey)</option>
                 #end
            							</select>
                #else
                						<input type="text" name="format-${formatKey}-$choiceKey" id="format-${formatKey}-$choiceKey" value="$!default" class="text">
                #end
            						</div>
                				</div>
               #end
                			</div>
            			</fieldset>
              #end
            		</div>
             #set($style = 'style="display:none;"')
            #end
        <script type="text/javascript">
        	function formatChanged() {
        #foreach($formatKey in $formats.keySet())
        		document.getElementById('format-$formatKey').style.display = 'none';
        #end
        		document.getElementById('format-' + document.formImport.format.options[document.formImport.format.options.selectedIndex].value).style.display = '';
        		return true;
        	}
        </script>
        
        </form>
</div>	
<script type="text/javascript">
##Hinweis und Rueckfrage vor dem Import

	function askStart() {
		htmlConfirm('Alle Dokumenttypen der zu importierenden Personen m&uuml;ssen im System vorhanden sein. Soll der Import jetzt gestartet werden?', new Array('Ja', 'Nein'), new Array("askStartYes();", "askStartNo();"));
	} 
	function askStartYes() {
		hideDialogs();
		showComboboxes();
		htmlWait();
		document.getElementById('formImport').submit();
	}
	function askStartNo() {
		hideDialogs();
		showComboboxes();
	}
</script>

##<!-- Bug 1362: Die M�glichkeit, einen bestehenden Exportvorgang zu laden, ist vom AA nicht gew�nscht -->
##<br>
##<hr class="contentsection" />
##<br>
##<h1>Bestehenden Importvorgang laden</h1>
##<form action="ImportPersonsStoredRecord" method="post" enctype="multipart/form-data">
##<table class="form"><tr>
##	<td class="label"><label for="importId">Import-ID:</label></td>
##	<td class="value" align="right">
##	    <input type="text" name="importId" id="importId" value="" class="text">
##	</td>
##</tr><tr>
##	<td class="label">&nbsp;</td>
##	<td class="value">
##		<input name="submit" type="submit" value="Laden" class="submit">
##	</td>
##</tr></table>
##</form>

#parse("inc/footer.vm")