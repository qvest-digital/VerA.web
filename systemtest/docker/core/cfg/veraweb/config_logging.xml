<?xml version="1.0" encoding="utf-8"?>
<!--!DOCTYPE tcModuleConfig SYSTEM "../tcModuleConfig.dtd"-->

<!--
	OCTOPUS config_logging.xml

	copy this file to /etc/veraweb/ and change things there,
	as config.xml itself cannot be moved
-->
<tcModuleConfig>
	<!-- **************** -->
	<!-- *** Logging: *** -->
	<!-- **************** -->
	<!-- Die in diesem Element enthaltenen param-Elemente erlauben, das Modul-eigene Logging zu steuern.

		 Neben dem Logging, das der tarent-octopus selber betreibt, gibt es ein Modul-internes
		 Logging. Dieses verwendet die Log4J-API, die dynamischer konfigurierbar ist als die
		 java.util.logging-API, die vom tarent-octopus benutzt wird.

		 Dieses Element wird mittels des Log4J-DOMConfigurators eingelesen. In ihm können nun
		 Log-Kategorien Level-Filter und Ausgabeschnittstellen zugeordnet werden. Details zu
		 den verfügbaren Optionen finden sich in der Log4J-Dokumentation, siehe
		 http://logging.apache.org/log4j/docs/

		 Das Modul veraweb nutzt im eigenen Code Kategorien, die nach dem vollständigen Klassennamen
		 (inklusive Package-Pfad) bezeichnet sind, so dass insbesondere die (Ober-)Kategorien
		 "de.tarent.aa.veraweb", "de.tarent.dblayer" und "de.tarent.octopus" interessant sind.

		 Ältere eingebundene Bibliotheken benutzen zum Teil Kategorien, die passend zu dem Inhalt
		 des Log-Kommentars bezeichnet sind, so dass die Kategorien "WORKER", "SQL" und "ERROR"
		 noch von Interesse sind.

		 Bei der Initialisierung des Moduls veraweb werden FileAppender der Kategorien "SQL",
		 "WORKER", "ERROR", "de.tarent.dblayer" und "de.tarent.aa.veraweb" manipuliert:
		 Falls der enthaltene Dateiname nicht leer ist, jedoch keinen Pfad enthält, wird
		 als Dateipfad das Verzeichnis "log" innerhalb des Modulverzeichnisses vorangesetzt.
	 -->
	<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/" debug="true">
		<category name="WORKER" additivity="false">
			<level value="WARN"/>
			<appender-ref ref="FileLog"/>
		</category>

		<category name="SQL" additivity="false">
			<level value="WARN"/>
			<appender-ref ref="FileLog"/>
		</category>

		<category name="ERROR">
			<level value="ALL"/>
			<appender-ref ref="ErrorLog"/>
		</category>

		<category name="de.tarent.dblayer" additivity="false">
			<level value="WARN"/>
			<appender-ref ref="FileLog"/>
		</category>

		<category name="de.tarent.aa.veraweb" additivity="false">
			<level value="ALL"/>
			<appender-ref ref="FileLog"/>
		</category>

		<category name="de.tarent.octopus" additivity="false">
			<level value="WARN"/>
			<appender-ref ref="FileLog"/>
		</category>

		<appender name="Console" class="org.apache.log4j.ConsoleAppender">
			<param name="Target" value="System.out"/>
			<layout class="org.apache.log4j.PatternLayout">
				<param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss.SSS} %7level (%thread) [%logger] %msg%n"/>
			</layout>
		</appender>

		<appender name="FileLog" class="org.apache.log4j.RollingFileAppender">
			<param name="MaxFileSize" value="1500KB"/>
			<param name="MaxBackupIndex" value="8"/>
			<param name="File" value="/usr/local/tomcat/logs/veraweb.log"/>
			<layout class="org.apache.log4j.PatternLayout">
				<param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss.SSS} %7level (%thread) [%logger] %msg%n"/>
			</layout>
		</appender>

		<appender name="ErrorLog" class="org.apache.log4j.RollingFileAppender">
			<param name="MaxFileSize" value="5MB"/>
			<param name="MaxBackupIndex" value="8"/>
			<param name="File" value="/usr/local/tomcat/logs/error.log"/>
			<layout class="org.apache.log4j.PatternLayout">
				<param name="ConversionPattern" value="%d{yyyy-MM-dd HH:mm:ss.SSS} %7level (%thread) [%logger] %msg%n"/>
			</layout>
		</appender>

		<appender name="Socket" class="org.apache.log4j.net.SocketAppender">
			<param name="RemoteHost" value="localhost"/>
			<param name="Port" value="4445"/>
		</appender>

		<root>
			<priority value="INFO"/>
		</root>
	</log4j:configuration>
</tcModuleConfig>
