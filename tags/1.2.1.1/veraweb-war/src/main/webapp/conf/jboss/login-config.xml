<?xml version='1.0'?>
<!DOCTYPE policy PUBLIC
      "-//JBoss//DTD JBOSS Security Config 3.0//EN"
      "http://www.jboss.org/j2ee/dtd/security_config.dtd">

<!-- The XML based JAAS login configuration read by the
org.jboss.security.auth.login.XMLLoginConfig mbean. Add
an application-policy element for each security domain.

The outline of the application-policy is:
<application-policy name="security-domain-name">
  <authentication>
    <login-module code="login.module1.class.name" flag="control_flag">
      <module-option name = "option1-name">option1-value</module-option>
      <module-option name = "option2-name">option2-value</module-option>
      ...
    </login-module>

    <login-module code="login.module2.class.name" flag="control_flag">
      ...
    </login-module>
    ...
  </authentication>
</application-policy>

$Revision: 1.1 $
-->

<policy>
    <!-- Used by clients within the application server VM such as
    mbeans and servlets that access EJBs.
    -->
    <application-policy name = "client-login">
       <authentication>
          <login-module code = "org.jboss.security.ClientLoginModule"
             flag = "required">
          </login-module>
       </authentication>
    </application-policy>

    <!-- Security domain for JBossMQ -->
    <application-policy name = "jbossmq">
       <authentication>
          <login-module code = "org.jboss.mq.sm.file.DynamicLoginModule"
             flag = "required">
             <module-option name = "unauthenticatedIdentity">guest</module-option>
             <module-option name = "sm.objectname">jboss.mq:service=StateManager</module-option>
          </login-module>
       </authentication>
    </application-policy>

    <!-- Security domains for testing new jca framework -->
    <application-policy name = "HsqlDbRealm">
       <authentication>
          <login-module code = "org.jboss.resource.security.ConfiguredIdentityLoginModule"
             flag = "required">
             <module-option name = "principal">sa</module-option>
             <module-option name = "userName">sa</module-option>
             <module-option name = "password"></module-option>
             <module-option name = "managedConnectionFactoryName">jboss.jca:service=LocalTxCM,name=DefaultDS</module-option>
          </login-module>
       </authentication>
    </application-policy>

    <application-policy name = "FirebirdDBRealm">
       <authentication>
          <login-module code = "org.jboss.resource.security.ConfiguredIdentityLoginModule"
             flag = "required">
             <module-option name = "principal">sysdba</module-option>
             <module-option name = "userName">sysdba</module-option>
             <module-option name = "password">masterkey</module-option>
             <module-option name = "managedConnectionFactoryName">jboss.jca:service=XaTxCM,name=FirebirdDS</module-option>
          </login-module>
       </authentication>
    </application-policy>

    <application-policy name = "JmsXARealm">
       <authentication>
          <login-module code = "org.jboss.resource.security.ConfiguredIdentityLoginModule"
             flag = "required">
             <module-option name = "principal">guest</module-option>
             <module-option name = "userName">guest</module-option>
             <module-option name = "password">guest</module-option>
             <module-option name = "managedConnectionFactoryName">jboss.jca:service=TxCM,name=JmsXA</module-option>
          </login-module>
       </authentication>
    </application-policy>

    <!-- A template configuration for the jmx-console web application. This
      defaults to the UsersRolesLoginModule the same as other and should be
      changed to a stronger authentication mechanism as required.
    -->
    <application-policy name = "jmx-console">
       <authentication>
          <login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule"
             flag = "required">
              <module-option name="usersProperties">jmx-console-users.properties</module-option>
              <module-option name="rolesProperties">jmx-console-roles.properties</module-option>
          </login-module>
       </authentication>
    </application-policy>

    <!-- A template configuration for the web-console web application. This
      defaults to the UsersRolesLoginModule the same as other and should be
      changed to a stronger authentication mechanism as required.
    -->
    <application-policy name = "web-console">
       <authentication>
          <login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule"
             flag = "required" />
       </authentication>
    </application-policy>

    <!-- The default login configuration used by any security domain that
    does not have a application-policy entry with a matching name
    -->
    <!-- mf // 02.02.2004 "other" disabled fuer "fitz-domain" -->
    <!--
    <application-policy name = "other">
    -->
       <!-- A simple server login module, which can be used when the number
       of users is relatively small. It uses two properties files:
       users.properties, which holds users (key) and their password (value).
       roles.properties, which holds users (key) and a comma-separated list of
       their roles (value).
       The unauthenticatedIdentity property defines the name of the principal
       that will be used when a null username and password are presented as is
       the case for an unuathenticated web client or MDB. If you want to
       allow such users to be authenticated add the property, e.g.,
       unauthenticatedIdentity="nobody"
       -->
    <!--
       <authentication>
          <login-module code = "org.jboss.security.auth.spi.UsersRolesLoginModule"
             flag = "required" />
       </authentication>
    </application-policy>
    -->

<!-- visa // 29.01.2004 -->
<!--
  <application-policy name = "fitz-domain">
    <authentication>
      <login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule"  flag = "required" />
    </authentication>
  </application-policy>
-->
  <application-policy name = "fitz-domain">
    <authentication>
      <login-module code = "de.visa.auth.LdapDbServerLoginModule"
        flag="required">
        <module-option name = "dsJndiName">java:/FitzDS</module-option>
        <module-option name = "principalsQuery">
          select ben_aktiv
            from fitz_benutzer, fitz_dienststelle
           where ben_login = ? and coalesce(ben_aktiv, false) = true
             and ben_dst_id = dst_id
             and dst_schluessel = ?
             and (select coalesce(dst_eingerichtet, false) from fitz_servicevertretung, fitz_dienststelle
                                                          where seve_dst_id = dst_id
                                                            and seve_fremd_dst_schluessel = ?)
        </module-option>
        <module-option name = "rolesQuery">
          select gruppe, null as "empty"
          from fitz_benutzer_gruppen_vw
          where login = ? and schluessel = ?
          union
          select 'disclaimer_set' as "gruppe", null as "empty"
          from fitz_benutzer, fitz_dienststelle
          where ben_login = ? and coalesce(ben_nutzungsbedingung, false) = true
            and ben_dst_id = dst_id
            and dst_schluessel = ?
        </module-option>

        <!-- siehe configuration.xml
        <module-option name = "ldapName"></module-option>
        -->
        <module-option name = "useTLS">false</module-option>
        <module-option name = "password-stacking">useFirstPass</module-option>

        <module-option name = "certificate-authority">CN=Server CA des AA,OU=Auswaertiges Amt,O=Bund,L=Bonn,ST=NRW,C=DE</module-option>

      </login-module>

<!--      <login-module code = "org.jboss.security.auth.spi.DatabaseServerLoginModule"
        flag="required">
        <module-option name = "dsJndiName">java:/FitzDS</module-option>
        <module-option name = "principalsQuery">
          select ben_login
            from fitz_benutzer
           where ben_login = ?
        </module-option>
        <module-option name = "rolesQuery">
          select gruppe, null as "empty"
          from fitz_benutzer_gruppen_vw
          where login = ?
        </module-option>
      </login-module>   -->

    </authentication>
  </application-policy>

  <application-policy name = "login-domain">
    <authentication>
      <login-module code="org.jboss.security.auth.spi.UsersRolesLoginModule"  flag = "required" />
    </authentication>
  </application-policy>

<!-- x-Manage - Start -->

    <application-policy name = "sync4j">
                <authentication>
                        <login-module code = "de.xdot.xmanage.jaas.MyLoginModuleJBOSS" flag="required">
                        <module-option name = "authType">AA</module-option>
                        </login-module>
                </authentication>
    </application-policy>

    <application-policy name = "x-manage">
                <authentication>
                        <login-module code = "de.xdot.xmanage.jaas.MyLoginModuleJBOSS" flag="required">
                        <module-option name = "authType">AA</module-option>
                        </login-module>
                </authentication>
    </application-policy>

<!-- x-Manage - Ende -->

</policy>

