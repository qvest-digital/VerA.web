## $Id$
#if($proxiesFor == 'ou')
	#set($activeMenu = "Administration")
	#set($title = "Verwaltung - alle Stellvertretungen im Mandanten")
#elseif($proxiesFor == 'all')
	#set($activeMenu = "Administration")
	#set($title = "Verwaltung - alle Stellvertretungen")
#elseif($proxiesFor == 'self')
	#set($activeMenu = "Verwaltung")
	#set($title = "Einstellungen - pers&ouml;nliche Stellvertretungen")
#else
	#set($activeMenu = "Administration")
	#set($title = "Stellvertretungen")
#end
#parse("inc/header.vm")	
<form id="formlist" name="formlist" action="$octopusRequest.task" method="POST">

<h1>Vertretungen</h1>

#if($listerrors && $listerrors.size() > 0)
<vera-warn>
	#foreach($error in $listerrors)
		$error<br>
	#end
</vera-warn>
#end

<input type="hidden" name="start" value="">
<input type="hidden" name="selectAll" value="false">
<input type="hidden" name="selectNone" value="false">
<input type="hidden" name="doInsert" value="true">
<input type="hidden" name="doUpdate" value="true">
<input type="hidden" name="doRemove" value="true">
#if($order)
<input type="hidden" name="order" value="$order">
#end

#foreach($bean in $list)
<input type="hidden" name="list" value="$bean.id">
#end
<div class="textRight mandatoryText">* = Pflichtfelder</div>
<fieldset class="filter"><legend>G&uuml;ltigkeitsfilter</legend>
	<input type="radio" id="validityIgnore" name="proxiesValid" value="ignore" onclick="submit();" #if($proxiesValid && $proxiesValid=='ignore')checked#end><label for="validityIgnore"> alle Vertretungen</label>&nbsp;&nbsp;
	<input type="radio" id="validityFuture" name="proxiesValid" value="future" onclick="submit();" #if((!$proxiesValid) || $proxiesValid=='future')checked#end><label for="validityFuture"> keine abgelaufenen Vertretungen</label>&nbsp;&nbsp;
	<input type="radio" id="validityNow" name="proxiesValid" value="now" onclick="submit();" #if($proxiesValid && $proxiesValid=='now')checked#end><label for="validityNow"> nur aktuelle Vertretungen</label>
</fieldset><br>

<table>
	<tr style="height: 20px;">
		<th style="width: 20px;">&nbsp;</th>
		<th style="width: 60px;">ID</th>
#if($proxiesFor != 'self')
 #if($proxiesFor != 'ou')
		<th><a href="?order=orgunit#if($proxiesValid)&proxiesValid=$proxiesValid#end">Mandant</a></th>
 #end
		<th><a href="?order=userRole#if($proxiesValid)&proxiesValid=$proxiesValid#end">Rolle*</a></th>
#end
		<th><a href="?order=proxy#if($proxiesValid)&proxiesValid=$proxiesValid#end">Vertreter*</a></th>
		<th style="width: 100px;"><a href="?order=validFrom#if($proxiesValid)&proxiesValid=$proxiesValid#end">G&uuml;ltig ab</a></th>
		<th style="width: 100px;"><a href="?order=validTill#if($proxiesValid)&proxiesValid=$proxiesValid#end">G&uuml;ltig bis</a></th>
	</tr>
	<tr>
		<td><input type="hidden" id="add-modified" name="add-modified" value="false"><input type="checkbox" name="add-select" value="true"  style="display: none;"></td>
		<td><input type="hidden" name="add-id" value=""><em>neu</em></td>
#if($proxiesFor != 'self')
 #if($proxiesFor != 'ou')
		<td></td>
 #end
		<td>
 #if($allUser)
			<select id="add-user" name="add-user"  style="width: 98%;" onchange="setModified('add')">
				<option value="">Bitte ausw&auml;hlen</option>
  #foreach($user in $allUser)
				<option value="$user.id">$user.name</option>
  #end
			</select>
 #else
			<input type="text" name="add-user" value=""  style="width: 96%;" onchange="setModified('add')">
 #end
		</td>
#else
		<input type="hidden" name="add-user" value="$!octopusConfig.personalConfig.verawebId">
#end
		<td>
#if($roleList)
			<select id="add-proxy" name="add-proxy"  style="width: 98%;" onchange="setModified('add')">
				<option value="">Bitte ausw&auml;hlen</option>
 #foreach($role in $roleList)
				<option value="$role">$role</option>
 #end
			</select>
#else
			<input type="text" name="add-proxy" value=""  style="width: 96%;" onchange="setModified('add')">
#end
		</td>
		<td>
			<nobr>
				<input type="text" name="add-validFrom" id="add-validFrom" value="" class="date" onchange="setModified('add')">
				<span id="show-add-from" class="datepickerContainer"><img src="${paths.staticWeb}images/calendar.png" alt="Datum ausw&auml;hlen" title="Datum ausw&auml;hlen"></span>
				<script type="text/javascript">
				    Calendar.setup({
						inputField     :    "add-validFrom",
						button         :    "show-add-from",
						ifFormat       :    "%d.%m.%Y",
						showsTime      :    false
					});
				</script>
			</nobr>
		</td>
		<td>
			<nobr>
				<input type="text" name="add-validTill" id="add-validTill" value="" class="date" onchange="setModified('add')">
				<span id="show-add-till" class="datepickerContainer"><img src="${paths.staticWeb}images/calendar.png" alt="Datum ausw&auml;hlen" title="Datum ausw&auml;hlen"></span>
				<script type="text/javascript">
				    Calendar.setup({
						inputField     :    "add-validTill",
						button         :    "show-add-till",
						ifFormat       :    "%d.%m.%Y",
						showsTime      :    false
					});
				</script>
			</nobr>
		</td>
	</tr>
	#foreach($bean in $list)
	#if ($velocityCount % 2 == 1)
		#set($class = "list1")
	#else
		#set($class = "list2")
	#end
	<tr class="$class">
		<td><input type="hidden" id="${bean.id}-modified" name="${bean.id}-modified" value="false"><input type="checkbox" name="${bean.id}-select" value="true"  #if($listselection.indexOf($bean.id) != -1) checked#end></td>
		<td><input type="hidden" name="${bean.id}-id" value="$!bean.id">$!{bean.id}<input type="hidden" name="${bean.id}-user" value="$!bean.user"></td>
#if($proxiesFor != 'self')
 #if($proxiesFor != 'ou')
		<td>
  #if(!$bean.orgunit)
			<i>no ou</i>
  #elseif(!$mapOrgUnit.get($bean.orgunit))
			<i>ou unknown</i>
  #else
			$!mapOrgUnit.get($bean.orgunit).name
  #end
		</td>
 #end
		<td><input type="text" name="${bean.id}-userRole" value="$!message.text($bean.userRole)"  style="width: 96%;" onchange="setModified('$!bean.id')" vera-disabled></td>
#end
		<td><input type="text" name="${bean.id}-proxy" value="$!message.text($bean.proxy)"  style="width: 96%;" onchange="setModified('$!bean.id')" vera-disabled></td>
		<td>
			<nobr>
				<input type="text" name="${bean.id}-validFrom" id="${bean.id}-validFrom" value="$!message.date("DATE", $bean.validFrom)" class="date" onchange="setModified('$!bean.id')">
				<span id="show-${bean.id}-from" class="datepickerContainer"><img src="${paths.staticWeb}images/calendar.png" alt="Datum ausw&auml;hlen" title="Datum ausw&auml;hlen"></span>
				<script type="text/javascript">
				    Calendar.setup({
						inputField     :    "${bean.id}-validFrom",
						button         :    "show-${bean.id}-from",
						ifFormat       :    "%d.%m.%Y",
						showsTime      :    false
					});
				</script>
			</nobr>
		</td>
		<td>
			<nobr>
				<input type="text" name="${bean.id}-validTill" id="${bean.id}-validTill" value="$!message.date("DATE", $bean.validTill)" class="date" onchange="setModified('$!bean.id')">
				<span id="show-${bean.id}-till" class="datepickerContainer"><img src="${paths.staticWeb}images/calendar.png" alt="Datum ausw&auml;hlen" title="Datum ausw&auml;hlen"></span>
				<script type="text/javascript">
				    Calendar.setup({
						inputField     :    "${bean.id}-validTill",
						button         :    "show-${bean.id}-till",
						ifFormat       :    "%d.%m.%Y",
						showsTime      :    false
					});
				</script>
			</nobr>
		</td>
	</tr>
	#end
</table>

#if ($listparam.count == 0)
	<br>Keine Daten gefunden.
#end

<div id="fixme" class="fixme1"><div class="fixme2"><div class="fixme3">

	#parse("inc/list-navi.vm")
	#parse("inc/list-direct.vm")

	<input type="submit" name="save" value="Speichern" class="submit">
	<input type="submit" name="remove" value="L&ouml;schen" class="button" title="markierte Eintr&auml;ge entfernen">

</div></div></div>




</form>

#parse("inc/footer.vm")